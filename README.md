# mp-extend

å¯å®šåˆ¶ï¼Œæ˜“æ‰©å±•çš„æ··å…¥å¼å°ç¨‹åº

> è¿™ä¸ªå°ç¨‹åºå†™äº 2019 å¹´ 3 æœˆï¼Œè¿™æ—¶æˆ‘è¿˜æ˜¯ä¸€ä¸ªå·¥ä½œä¸æ»¡ä¸€å¹´çš„å°èœé¸¡ï¼Œå†™è¿™ä¸ªå°ç¨‹åºçš„ä¸»è¦ç›®çš„æ˜¯è®©å¹³æ—¶æ‰€å­¦ä¹ çš„ä¸œè¥¿èƒ½å¤Ÿå­¦ä»¥è‡´ç”¨ï¼Œè™½ç„¶ç°åœ¨å›å¤´ä¸€çœ‹å†™çš„ç¡®å®ä¸å’‹çš„ï¼Œä½†æ˜¯èƒ½å¤Ÿåœ¨ä¸éœ€è¦ä¿®æ”¹åŸæœ‰å°ç¨‹åºä»£ç çš„æ–¹å¼ä¸‹åšä¸€ç‚¹å°å°çš„æ‹“å±•ï¼Œä¹Ÿç®—æ˜¯ä¸€ä¸ªä¸é”™çš„å°è¯•ã€‚è€Œç°åœ¨[å¾®ä¿¡ä¹Ÿå·²ç»åŸç”Ÿæä¾›äº† Mixin ](https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/behaviors.html)çš„åŠŸèƒ½ï¼Œç”±æ­¤å¯ä»¥çœ‹å‡ºè¿™ä¸ªå°ç¨‹åºä¸­æ ¸å¿ƒçš„ Mixin èƒ½åŠ›ä¹Ÿæ˜¯ååˆ†æœ‰ç”¨çš„ã€‚æœ€åä¹Ÿå¤šè°¢èµ ä¸æˆ‘å°æ˜Ÿæ˜Ÿçš„æœ‹å‹ï¼Œå†™çš„ä»£ç æœ‰äººçœ‹çœŸçš„æœ€å¤§çš„é¼“åŠ±ğŸ˜‹ã€‚

## ç›®å½• ##

- [è®¾è®¡ç†å¿µ](#è®¾è®¡ç†å¿µ) 
- [å¿«é€Ÿä½“éªŒ](#å¿«é€Ÿä½“éªŒ)
- [APIåˆ—è¡¨](#APIåˆ—è¡¨)
- [æœ€ç®€å•çš„ä½¿ç”¨ç¤ºä¾‹](#æœ€ç®€å•çš„ä½¿ç”¨ç¤ºä¾‹)
- [æ‰©å±•åŠŸèƒ½](#æ‰©å±•åŠŸèƒ½)

## è®¾è®¡ç†å¿µ ##

åˆ°2019å¹´ä¸ºæ­¢ï¼Œå°ç¨‹åºå…¬æµ‹ä¸¤å¹´å¤šäº†ï¼Œæˆ‘è‡ªå‚åŠ å·¥ä½œåŠå¹´å¤šçš„æ—¶é—´é‡Œæœ‰è¶…è¿‡ä¸‰åˆ†ä¹‹ä¸€çš„æ—¶é—´éƒ½åœ¨å’Œå°ç¨‹åºæ‰“äº¤é“ï¼Œå› ä¸ºå°ç¨‹åºæ¡†æ¶ä¸­æŸäº›éƒ¨åˆ†ä¸å®Œå–„ä¹Ÿè¸©äº†è®¸å¤šçš„å‘ã€‚åæ¥å¸‚åœºä¸Šå‡ºç°äº†ä¸€äº›å°ç¨‹åºçš„æ¡†æ¶ï¼Œå¤§è‡´åˆ†ä¸ºä¸¤ç±»ï¼šä½¿ç”¨å…¶ä»–æŠ€æœ¯æ ˆå¼€å‘çš„ï¼ˆ[mpvue](https://github.com/Meituan-Dianping/mpvue)ï¼Œ[Taro](https://github.com/NervJS/taro)ï¼Œ[wePY](https://github.com/Tencent/wepy)ï¼‰å’Œåœ¨å°ç¨‹åºåŸæœ‰æ¡†æ¶ä¸Šè¿›è¡Œæ‹“å±•çš„ï¼ˆ[omix](https://github.com/Tencent/omi/tree/master/packages/omix)ï¼Œ[wxpage](https://github.com/Tencent/wepy)ç­‰ï¼‰ã€‚

ç”±äºä¸šåŠ¡ä¸Šæ²¡æœ‰å¤šç«¯åŒæ„çš„éœ€æ±‚ï¼Œæˆ‘æ²¡æœ‰è€ƒè™‘ä½¿ç”¨å…¶ä»–æŠ€æœ¯æ ˆå¼€å‘å°ç¨‹åºï¼ˆå°ç¨‹åºå·²ç»å¤Ÿå‘äº†è¿˜è¦è·³å¦ä¸€ä¸ªå‘ï¼‰ã€‚ä½†æ˜¯åœ¨å°è¯•ä½¿ç”¨è¿™äº›å°ç¨‹åºçš„æ¡†æ¶æ—¶å´é‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼š

1. æ¡†æ¶æ‹“å±•äº†ä¸€äº›æˆ‘ä¸æƒ³è¦çš„æ–¹æ³•

2. éš¾ä»¥åŒæ—¶ä½¿ç”¨å¤šä¸ªæ¡†æ¶ã€‚

ä¸ºäº†è§£å†³ä»¥ä¸Šçš„é—®é¢˜ï¼Œå†™äº†[mp-extend](https://github.com/WozHuang/mp-extend)ï¼Œå…¶ä¸­å‚è€ƒäº† Vue çš„æ··å…¥æ–¹æ³•ï¼Œä»¥å…¨å±€æ··å…¥çš„æ–¹å¼æ‹“å±•å°ç¨‹åºçš„APIï¼ŒåŒæ—¶å…·æœ‰å¯å®šåˆ¶ã€æ˜“æ‰©å±•ã€ä»£ç å…¥ä¾µå°‘çš„ä¼˜ç‚¹ã€‚

PSï¼šå¦‚æœå¯¹[æºç ](https://github.com/WozHuang/mp-extend/blob/master/demo/mp-extend/mp-extend.js)å®ç°æœ‰å…´è¶£çš„å¯ä»¥çœ‹çœ‹[è¿™ç¯‡æ–‡ç« ](https://www.cnblogs.com/wozho/p/10442703.html)

## å¿«é€Ÿä½“éªŒ ##

ä½¿ç”¨å¾®ä¿¡å¼€å‘è€…å·¥å…·æ‰“å¼€[demo](https://github.com/WozHuang/mp-extend/tree/master/demo)æ–‡ä»¶å¤¹ä¸­çš„å°ç¨‹åºæˆ–è€…ç›´æ¥ä½¿ç”¨å¾®ä¿¡æä¾›çš„çš„[ä»£ç ç‰‡æ®µ](https://developers.weixin.qq.com/s/6vJNKFmV777M)åŠŸèƒ½å¯¼å…¥é¡¹ç›®ã€‚

## APIåˆ—è¡¨ ##

- **mpExtend**(mixinOption)

	æ ¸å¿ƒæ–¹æ³•ï¼Œæä¾›å…¨å±€æ··å…¥çš„èƒ½åŠ›ï¼Œæ¥æ”¶ä¸€ä¸ª `mixinOption` æˆ– ä¸€ä¸ª`[mixinOption]` æ•°ç»„ï¼Œ
	åˆå¹¶ç­–ç•¥[ä¸Vueä¸€è‡´](https://cn.vuejs.org/v2/guide/mixins.html#%E9%80%89%E9%A1%B9%E5%90%88%E5%B9%B6)ï¼ˆåˆå¹¶dataå¯¹è±¡ï¼Œæ–¹æ³•ä¼˜å…ˆä½¿ç”¨é¡µé¢ç»„ä»¶å®šä¹‰çš„æ–¹æ³•ï¼‰

	`mixinOption`æ ¼å¼ä¸å°ç¨‹åºåŸæœ‰çš„å¼€å‘æ¨¡å¼å®Œå…¨ç›¸åŒï¼Œåªæ˜¯åˆ†æˆäº†APPï¼ŒPageï¼ŒComponentä¸‰ä¸ªéƒ¨åˆ†

	```js
	{
	  App: {
	    onLaunch(option){
	      // åœ¨Appçš„onLaunchå‰è°ƒç”¨
	    }
	    // ...
	  },
	  Page: {
	    preprocess(pageOption){
	      // åœ¨è°ƒç”¨Pageå‡½æ•°å‰ä¼šè¢«è°ƒç”¨ï¼Œå¯ä»¥ç”¨äºä¿®æ”¹æ‰€æœ‰çš„ pageOption
	    }
	    onLoad(option){
	      // æ‰€æœ‰é¡µé¢onLoadå‰è°ƒç”¨
	    }
	  },
	  Component: {
	    created(){
	      // æ‰€æœ‰ç»„ä»¶createdå‰è°ƒç”¨
	    }
	  }
	}
	```

	æ‰€æœ‰çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°éƒ½ä¼šè¢«æ··å…¥åˆ°åŸæœ‰çš„Pageå¯¹è±¡ä¸­ï¼Œåœ¨é¡µé¢çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ä¹‹å‰æ‰§è¡Œ
	å¯¹è±¡ç±»å‹ä¼šä»¥é€’å½’åˆå¹¶çš„æ–¹å¼æ··å…¥ï¼Œæ–¹æ³•ä¼˜å…ˆä½¿ç”¨Pageå¯¹è±¡ä¸­åŸæœ‰çš„æ–¹æ³•
	
	å¦å¤–è¿˜æ¥å—ä¸€ä¸ªæ–¹æ³• `preprocess`ï¼Œæ¥æ”¶ä¸€ä¸ªå‚æ•° `PageOption` ï¼Œèƒ½å¤Ÿç”¨äºè°ƒç”¨Pageæ–¹æ³•å‰å¯¹ `PageOption` è¿›è¡Œä¿®æ”¹
	
- **mpExtend.App**

	åˆ›å»ºå°ç¨‹åº

- **mpExtend.Page**

	åˆ›å»ºé¡µé¢

- **mpExtend.Component**

	åˆ›å»ºç»„ä»¶

	> å¯ä»¥ç›´æ¥åœ¨Appæ–¹æ³•è°ƒç”¨å‰æ›¿æ¢æ‰å°ç¨‹åºåŸæœ‰çš„Appã€Pageã€Componentï¼Œé¿å…å¤šä¸ªé¡µé¢å¼•ç”¨çš„éº»çƒ¦
	
	```js
	// app.js
	import mpExtend from './mp-extend.js'
	App = mpExtend.App
	Page = mpExtend.Page
	Component = mpExtend.Component
	```

## æœ€ç®€å•çš„ä½¿ç”¨ç¤ºä¾‹ ##

1. ä¸ºæ‰€æœ‰é¡µé¢çš„æ·»åŠ ä¸€ä¸ªdataå±æ€§å’Œä¸€ä¸ªæ–¹æ³•

	```js
	mpExtend({
	  Page: {
	
	    // dataå±æ€§ä¼šè¢«æ··å…¥åˆ°é¡µé¢çš„åŸæœ‰dataä¸­
	    data: {
	      exData: 'æˆ‘ä¼šè¢«æ··å…¥åˆ°æ‰€æœ‰Pageä¸­'
	    },
	
	    // æ‰€æœ‰é¡µé¢éƒ½ä¼šè·å¾—showDataæ–¹æ³•
	    // å¦‚æœé¡µé¢å·²æœ‰showDataåˆ™ä½¿ç”¨é¡µé¢è‡ªèº«çš„æ–¹æ³•
	    showData(){
	      console.log(this.data.exData);
	    }
	    
	  }
	})
	```

2. å¢åŠ ä¸€ä¸ªPVç»Ÿè®¡åŠŸèƒ½

	> åœ¨å°ç¨‹åºå¯åŠ¨æ—¶ã€è¿›å…¥é¡µé¢æ—¶ä¼šåœ¨æ§åˆ¶å°è¾“å‡ºå¯¹åº”ä¿¡æ¯
	
	```js
	mpExtend({
	  App: {
	    onLaunch(){
	      console.log(`æ‰“å¼€äº†å°ç¨‹åº`)
	    }
	  },
	  Page: {
	    onLoad(){
	      console.log(`PVç»Ÿè®¡: åœ¨${formatTime(new Date())} æ‰“å¼€äº†é¡µé¢ ${this.__route__}`)
	    }
	  }
	})
	```

## æ‰©å±•åŠŸèƒ½ ##

| **æ‰©å±•å**| **æè¿°**|
| ------------------------------- | ----------------------------------- |
| [extend-globalData](#extend-globalData)| å…¨å±€setData |
| [extend-mitt](#extend-mitt)| å…¨å±€äº‹ä»¶ç›‘å¬è§¦å‘ |
| [extend-preload](#extend-preload)| é¡µé¢é¢„åŠ è½½ |
| [extend-oData](#extend-oData)| å¼•å…¥å…¶ä»–å°ç¨‹åºæ¡†æ¶çš„ç¤ºä¾‹ |

### extend-globalData ### 

[å®ç°åŸç†](https://www.cnblogs.com/wozho/p/10443999.html)

- **this.data.$globalData**

	åœ¨é¡µé¢ä¸­è·å–åˆ°å½“å‰ app.globalData çš„å€¼

- **this.$globalSetData()**

	ä¸æ™®é€šçš„setDataä¸€æ ·çš„è°ƒç”¨æ–¹å¼ï¼Œä½†èƒ½å¤Ÿå®ç°å…¨å±€æ•°æ®çš„æ›´æ–°ï¼Œå¹¶åœ¨ä»£ç å®ç°ä¸­å……åˆ†è€ƒè™‘äº†å°ç¨‹åºçš„æ€§èƒ½ç“¶é¢ˆï¼Œä»…åœ¨é¡µé¢æ˜¾ç¤ºonShowæ—¶æ‰è°ƒç”¨setDataè¿›è¡Œæ›´æ–°æ“ä½œ

### extend-mitt ###

- **this.$on()**

	ç›‘å¬äº‹ä»¶

- **this.$off()**

	å–æ¶ˆç›‘å¬äº‹ä»¶

- **this.$emit()**

	è§¦å‘äº‹ä»¶

### extend-preload ###

[å®ç°åŸç†](https://www.cnblogs.com/wozho/p/10444010.html)

- **this.$preload()**

	é¢„åŠ è½½æŒ‡å®šé¡µé¢çš„å€¼ï¼Œä¼ å…¥ä¸€ä¸ªé¡µé¢è·¯å¾„ï¼ˆä¸wx.navigateToç›¸åŒçš„urlï¼Œå¯ä»¥å¸¦å‚æ•°ï¼‰

- **æ·»åŠ onPreloadç”Ÿå‘½å‘¨æœŸ**

	å‡ ä¹ä¸onLoadåŠŸèƒ½æ— å¼‚ï¼Œä¼šåœ¨é¡µé¢onLoadå‰è¢«è°ƒç”¨ï¼Œä½†å¯ä»¥ææ—©ç”¨$preloadé¢„åŠ è½½ï¼Œåœ¨å…¶ä¸­å¯ä»¥æ­£å¸¸çš„ä½¿ç”¨setDataå’Œè°ƒç”¨å‡½æ•°ã€‚å¦‚æœé¡µé¢å·²ç»åŠ è½½ï¼ŒsetDataä¼šç›´æ¥è°ƒç”¨é¡µé¢çš„setDataï¼Œå¦‚æœé¡µé¢æœªåŠ è½½ä¼šæŠŠsetDataçš„æ•°æ®æš‚å­˜èµ·æ¥ï¼Œç­‰åˆ°é¡µé¢åŠ è½½æ—¶å†è°ƒç”¨

- **æ·»åŠ pathå±æ€§ï¼ˆå¿…é¡»ï¼‰**

	ç”±äºå°ç¨‹åºè°ƒç”¨Pageæ–¹æ³•æ—¶æ— æ³•è·å–åˆ°é¡µé¢è·¯å¾„ï¼Œåªèƒ½é€šè¿‡æ·»åŠ pathå±æ€§å¯¹é¡µé¢è¿›è¡Œåˆ†è¾¨ï¼Œéœ€è¦ä¸app.jsonä¸­çš„é¡µé¢è·¯å¾„ç›¸åŒ

### extend-oData ###

ä½œä¸ºå¼•å…¥å…¶ä»–çš„å°ç¨‹åºæ¡†æ¶çš„ç¤ºä¾‹, è¿™é‡Œå¼•å…¥äº† omi (https://github.com/Tencent/omi) ä¸­çš„ omix

- **this.oData**
	this.dataçš„ä¸€ä¸ªå‰¯æœ¬ï¼Œç›´æ¥ä¿®æ”¹oDataä¼šè‡ªåŠ¨è°ƒç”¨this.setDataï¼Œå¦‚ 

	```js
	this.oData.msg = 'hello';
	```
		
	ç­‰ä»·äº
		
	```js
	this.setData({ msg: 'hello'});
	```

## æœ€å ##

é€šè¿‡è¿™ä¸ªé¡¹ç›®ï¼Œç»ˆäºå¯ä»¥éšå¿ƒæ‰€æ¬²åœ°å®šåˆ¶è‡ªå·±çš„å°ç¨‹åºæ¡†æ¶äº†ï¼Œçœ‹åˆ°å…¶ä»–ä¼˜ç§€çš„apiéƒ½å¯ä»¥æ–¹ä¾¿åœ°å¼•å…¥è¿›å»ã€‚

å¦‚æœè§‰å¾—æœ‰ç”¨å¯ä»¥ç»™æˆ‘ä¸€ä¸ªå°æ˜Ÿæ˜Ÿï¼ˆæ»¡è„¸æœŸå¾….jpgï¼‰ï¼Œæœ‰æ–°çš„æ‰©å±•æˆ–æƒ³æ³•ä¹Ÿæ¬¢è¿issueå’ŒPRã€‚

## å‚è€ƒ

> [wxpage](https://github.com/tvfe/wxpage)
> [omi](https://github.com/Tencent/omi)
> [Vue mixins](https://cn.vuejs.org/v2/guide/mixins.html#%E9%80%89%E9%A1%B9%E5%90%88%E5%B9%B6)
> [å¾®ä¿¡å°ç¨‹åºä¹‹æé«˜åº”ç”¨é€Ÿåº¦å°æŠ€å·§](https://wetest.qq.com/lab/view/294.html)